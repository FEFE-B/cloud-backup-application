<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Altaro Cloud Backup - Testing Documentation</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #27ae60;
            --bg-color: #f8f9fa;
            --text-color: #333;
            --border-color: #e1e4e8;
            --code-bg: #f6f8fa;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            margin-bottom: 40px;
            border-radius: 0 0 8px 8px;
            text-align: center;
        }

        nav {
            background-color: white;
            padding: 15px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }

        nav ul li {
            margin: 0 15px;
        }

        nav ul li a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        nav ul li a:hover {
            color: var(--secondary-color);
            text-decoration: underline;
        }

        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 40px;
        }

        h1, h2, h3, h4 {
            color: var(--primary-color);
            margin-top: 30px;
            margin-bottom: 15px;
        }

        h1 {
            font-size: 2.5rem;
        }

        h2 {
            font-size: 1.8rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }

        h3 {
            font-size: 1.4rem;
            margin-top: 25px;
        }

        p {
            margin-bottom: 15px;
        }

        ul, ol {
            margin-bottom: 20px;
            padding-left: 30px;
        }

        li {
            margin-bottom: 8px;
        }

        code {
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--code-bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        pre {
            background-color: var(--code-bg);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .pyramid {
            width: 300px;
            margin: 30px auto;
            display: block;
            text-align: center;
            font-family: monospace;
            white-space: pre;
            line-height: 1.2;
        }

        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--secondary-color);
        }

        .card-content {
            margin-bottom: 10px;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .badge-unit {
            background-color: #e1f5fe;
            color: #0288d1;
        }

        .badge-integration {
            background-color: #e8f5e9;
            color: #388e3c;
        }

        .badge-e2e {
            background-color: #fff8e1;
            color: #ffa000;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--bg-color);
            font-weight: 600;
        }

        tr:hover {
            background-color: var(--bg-color);
        }

        .btn {
            display: inline-block;
            background-color: var(--secondary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            text-decoration: none;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #2980b9;
        }

        .btn-primary {
            background-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: #1a252f;
        }

        .btn-success {
            background-color: var(--accent-color);
        }

        .btn-success:hover {
            background-color: #219653;
        }

        .center-buttons {
            text-align: center;
            margin: 30px 0;
        }
        
        .progress-bar {
            background-color: var(--secondary-color);
            color: white;
            text-align: center;
            padding: 5px;
            border-radius: 4px;
        }
        
        .progress-bar-78 {
            width: 78%;
        }
        
        .progress-bar-65 {
            width: 65%;
        }

        footer {
            text-align: center;
            padding: 20px 0;
            margin-top: 50px;
            border-top: 1px solid var(--border-color);
            color: #666;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }

            nav ul {
                flex-direction: column;
                align-items: center;
            }

            nav ul li {
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Altaro Cloud Backup Software</h1>
        <p>Comprehensive Testing Documentation</p>
    </header>

    <nav>
        <ul>
            <li><a href="#overview">Overview</a></li>
            <li><a href="#unit-tests">Unit Tests</a></li>
            <li><a href="#integration-tests">Integration Tests</a></li>
            <li><a href="#e2e-tests">E2E Tests</a></li>
            <li><a href="#coverage">Coverage</a></li>
            <li><a href="#best-practices">Best Practices</a></li>
            <li><a href="#frontend-testing">Frontend Testing</a></li>
            <li><a href="#ci-cd">CI/CD</a></li>
        </ul>
    </nav>

    <div class="container">
        <h2 id="overview">Testing Strategy Overview</h2>
        
        <p>Our testing approach follows the testing pyramid, with a strong focus on unit tests that are fast, reliable, and provide good coverage, supplemented by integration and end-to-end tests to ensure that all components work together correctly.</p>
        
        <div class="pyramid">
            <code>
    /\
   /  \
  /E2E \
 /------\
/        \
/Integration\
/------------\
/              \
/     Unit      \
/----------------\
            </code>
        </div>
        
        <p>Each level of the pyramid serves a specific purpose in our testing strategy:</p>
        
        <ul>
            <li><strong>Unit Tests</strong>: Fast, isolated tests that verify individual components function correctly</li>
            <li><strong>Integration Tests</strong>: Test how components work together (e.g., API + Database)</li>
            <li><strong>E2E Tests</strong>: Simulate real user scenarios across the entire application stack</li>
        </ul>
    </div>

    <div class="container">
        <h2 id="unit-tests">Unit Tests</h2>
        
        <p>Unit tests focus on testing individual components (functions, classes, modules) in isolation. These tests make up the majority of our test suite and provide quick feedback during development.</p>
        
        <h3>Key Areas</h3>
        
        <div class="grid">
            <div class="card">
                <div class="card-title">Models</div>
                <div class="card-content">
                    <span class="badge badge-unit">Unit</span>
                    <p>Tests for all database models ensuring proper validation, relationships, and methods.</p>
                </div>
                <code>tests/unit/models/</code>
            </div>
            
            <div class="card">
                <div class="card-title">Controllers</div>
                <div class="card-content">
                    <span class="badge badge-unit">Unit</span>
                    <p>Tests for controller logic, ensuring correct responses and proper error handling.</p>
                </div>
                <code>tests/unit/controllers/</code>
            </div>
            
            <div class="card">
                <div class="card-title">Utilities</div>
                <div class="card-content">
                    <span class="badge badge-unit">Unit</span>
                    <p>Tests for utility functions like email services, encryption, and schedulers.</p>
                </div>
                <code>tests/unit/utils/</code>
            </div>
        </div>
        
        <h3>Example: User Model Test</h3>
        
        <pre><code>const mongoose = require('mongoose');
const User = require('../../../models/User');

describe('User Model Tests', () => {
  let userData;

  beforeEach(() => {
    userData = {
      name: 'Test User',
      email: 'test@example.com',
      password: 'password123',
      company: 'Test Company',
      role: 'user'
    };
  });

  it('should create a new user successfully', async () => {
    const validUser = new User(userData);
    const savedUser = await validUser.save();
    
    expect(savedUser._id).toBeDefined();
    expect(savedUser.name).toBe(userData.name);
    expect(savedUser.email).toBe(userData.email);
  });

  it('should fail to create user without required fields', async () => {
    const userWithoutRequiredField = new User({
      name: 'Test User',
      // email is missing
    });

    let error;
    try {
      await userWithoutRequiredField.save();
    } catch (err) {
      error = err;
    }

    expect(error).toBeDefined();
    expect(error.errors.email).toBeDefined();
  });
});</code></pre>

        <h3>Running Unit Tests</h3>
        
        <p>To run unit tests specifically:</p>
        
        <pre><code>npm run test:unit</code></pre>
    </div>

    <div class="container">
        <h2 id="integration-tests">Integration Tests</h2>
        
        <p>Integration tests verify that multiple components work together correctly. These tests usually involve testing API endpoints and database interactions.</p>
        
        <h3>Key Areas</h3>
        
        <div class="grid">
            <div class="card">
                <div class="card-title">API Routes</div>
                <div class="card-content">
                    <span class="badge badge-integration">Integration</span>
                    <p>Tests for API endpoints, ensuring proper request/response handling and routing.</p>
                </div>
                <code>tests/integration/</code>
            </div>
            
            <div class="card">
                <div class="card-title">Database Operations</div>
                <div class="card-content">
                    <span class="badge badge-integration">Integration</span>
                    <p>Tests for complex database operations involving multiple collections.</p>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">Authentication</div>
                <div class="card-content">
                    <span class="badge badge-integration">Integration</span>
                    <p>Tests for authentication flows and middleware functionality.</p>
                </div>
            </div>
        </div>
        
        <h3>Example: Auth Routes Test</h3>
        
        <pre><code>const request = require('supertest');
const express = require('express');
const mongoose = require('mongoose');
const User = require('../../models/User');
const authRoutes = require('../../routes/auth.routes');

// Create an express application for testing
const app = express();
app.use(express.json());
app.use('/api/auth', authRoutes);

describe('Auth Routes Integration Tests', () => {
  describe('POST /api/auth/register', () => {
    it('should register a new user', async () => {
      const res = await request(app)
        .post('/api/auth/register')
        .send({
          name: 'Test User',
          email: 'test@example.com',
          password: 'password123',
          company: 'Test Company'
        });

      expect(res.statusCode).toBe(201);
      expect(res.body.success).toBe(true);
      expect(res.body.token).toBeDefined();
      
      // Check if user was created in database
      const user = await User.findOne({ email: 'test@example.com' });
      expect(user).toBeDefined();
      expect(user.name).toBe('Test User');
    });
  });
});</code></pre>

        <h3>Running Integration Tests</h3>
        
        <pre><code>npm run test:integration</code></pre>
    </div>

    <div class="container">
        <h2 id="e2e-tests">End-to-End Tests</h2>
        
        <p>End-to-End (E2E) tests simulate real user scenarios and test the entire application stack from the API down to the database.</p>
        
        <h3>Key Areas</h3>
        
        <div class="grid">
            <div class="card">
                <div class="card-title">User Workflows</div>
                <div class="card-content">
                    <span class="badge badge-e2e">E2E</span>
                    <p>Tests for complete user journeys like registration, backup creation, and renewal processing.</p>
                </div>
                <code>tests/e2e/</code>
            </div>
            
            <div class="card">
                <div class="card-title">Admin Functionality</div>
                <div class="card-content">
                    <span class="badge badge-e2e">E2E</span>
                    <p>Tests for admin workflows like user management, renewal processing, and dashboard functionality.</p>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">System Processes</div>
                <div class="card-content">
                    <span class="badge badge-e2e">E2E</span>
                    <p>Tests for background processes like backup execution and renewal notifications.</p>
                </div>
            </div>
        </div>
        
        <h3>Example: Admin E2E Test</h3>
        
        <pre><code>const request = require('supertest');
const mongoose = require('mongoose');
const User = require('../../models/User');
const Backup = require('../../models/Backup');
const Renewal = require('../../models/Renewal');

describe('Admin E2E Tests', () => {
  let adminToken;
  let regularUser;
  let testRenewal;

  beforeEach(async () => {
    // Setup test data...
    
    // Login as admin
    const adminLoginRes = await request(app)
      .post('/api/auth/login')
      .send({
        email: 'admin@example.com',
        password: 'adminpass'
      });
    adminToken = adminLoginRes.body.token;
  });

  it('should process renewal payment', async () => {
    const res = await request(app)
      .post(`/api/admin/renewals/${testRenewal._id}/process-payment`)
      .set('Authorization', `Bearer ${adminToken}`)
      .send({
        amount: 99.99,
        paymentMethod: 'bank_transfer',
        notes: 'Manual payment processed by admin'
      });
    
    expect(res.statusCode).toBe(200);
    expect(res.body.success).toBe(true);
    expect(res.body.data.renewal.status).toBe('paid');
    
    // Verify payment was recorded
    const updatedRenewal = await Renewal.findById(testRenewal._id);
    expect(updatedRenewal.payments.length).toBe(1);
  });
});</code></pre>

        <h3>Running E2E Tests</h3>
        
        <pre><code>npm run test:e2e</code></pre>
    </div>

    <div class="container">
        <h2 id="coverage">Test Coverage</h2>
        
        <p>We aim for a minimum test coverage of:</p>
        
        <table>
            <tr>
                <th>Metric</th>
                <th>Target</th>
            </tr>
            <tr>
                <td>Statements</td>
                <td>70%</td>
            </tr>
            <tr>
                <td>Branches</td>
                <td>60%</td>
            </tr>
            <tr>
                <td>Functions</td>
                <td>70%</td>
            </tr>
            <tr>
                <td>Lines</td>
                <td>70%</td>
            </tr>
        </table>
        
        <p>Coverage reports are generated when running:</p>
        
        <pre><code>npm run test:coverage</code></pre>
        
        <p>The report is saved to the <code>backend/coverage</code> directory and can be viewed in a web browser.</p>
        
        <div style="text-align: center; margin: 30px 0;">
            <a href="./coverage/lcov-report/index.html" class="btn btn-primary">View Latest Coverage Report</a>
        </div>
    </div>

    <div class="container">
        <h2 id="best-practices">Testing Best Practices</h2>
        
        <h3>1. Test Independence</h3>
        <p>Each test should be independent and not rely on the state from other tests. Use beforeEach to set up clean test data.</p>
        
        <h3>2. Arrange-Act-Assert</h3>
        <p>Structure tests with clear setup (Arrange), action being tested (Act), and verification (Assert) phases.</p>
        
        <pre><code>it('should update user profile', async () => {
  // Arrange
  const user = await User.create({...}); // Setup test data
  
  // Act
  const res = await request(app)
    .put('/api/users/profile')
    .set('Authorization', `Bearer ${token}`)
    .send({
      name: 'Updated Name'
    });
  
  // Assert
  expect(res.statusCode).toBe(200);
  expect(res.body.data.name).toBe('Updated Name');
});</code></pre>
        
        <h3>3. Meaningful Assertions</h3>
        <p>Test the behavior, not the implementation. Verify outcomes rather than implementation details.</p>
        
        <h3>4. Test One Thing</h3>
        <p>Each test should verify one specific behavior or aspect of the code.</p>
        
        <h3>5. Clean Setup/Teardown</h3>
        <p>Use beforeEach/afterEach hooks to ensure a clean test environment for each test.</p>
    </div>

    <div class="container">
        <h2 id="frontend-testing">Frontend Testing</h2>
        
        <p>We have implemented a comprehensive frontend testing strategy for React components, context, and pages.</p>
        
        <h3>Component Tests</h3>
        <p>Component tests verify that UI components render correctly and handle user interactions as expected.</p>
        <div class="code-block">
            <pre><code>// Layout.test.js
import React from 'react';
import { render, screen } from '@testing-library/react';
import { BrowserRouter } from 'react-router-dom';
import { AuthContext } from '../../context/AuthContext';
import Layout from '../layout/Layout';

describe('Layout Component', () => {
  it('renders layout with navigation when unauthenticated', () => {
    // Render component with providers
    renderWithProviders(&lt;Layout /&gt;);
    
    // Verify navigation items for unauthenticated users
    expect(screen.getByText(/Home/i)).toBeInTheDocument();
    expect(screen.getByText(/Login/i)).toBeInTheDocument();
    expect(screen.getByText(/Register/i)).toBeInTheDocument();
  });
});</code></pre>
        </div>
        
        <h3>Context API Tests</h3>
        <p>Context API tests verify that state management works correctly across the application.</p>
        <div class="code-block">
            <pre><code>// AuthContext.test.js
import React from 'react';
import { render, act, waitFor, screen } from '@testing-library/react';
import { AuthProvider, useAuth } from '../../context/AuthContext';

describe('AuthContext', () => {
  it('handles successful login', async () => {
    // Setup mock API
    axios.post.mockResolvedValueOnce({
      data: {
        success: true,
        token: 'new-jwt-token',
        user: {
          name: 'Test User',
          email: 'test@example.com',
          role: 'user'
        }
      }
    });
    
    // Render with context
    render(&lt;AuthProvider&gt;&lt;TestComponent /&gt;&lt;/AuthProvider&gt;);
    
    // Trigger login
    act(() => {
      screen.getByTestId('login-btn').click();
    });
    
    // Verify authenticated state
    await waitFor(() => {
      expect(screen.getByTestId('auth-status')).toHaveTextContent('Authenticated');
    });
  });
});</code></pre>
        </div>
        
        <h3>Page Component Tests</h3>
        <p>Page tests verify that full page components integrate correctly with API calls and user interactions.</p>
        <div class="code-block">
            <pre><code>// Backups.test.js
import React from 'react';
import { render, screen, waitFor, fireEvent } from '@testing-library/react';
import Backups from '../Backups';
import axios from 'axios';

describe('Backups Page', () => {
  it('displays backups when loaded successfully', async () => {
    // Mock API response
    axios.get.mockResolvedValueOnce({
      data: {
        success: true,
        data: mockBackups
      }
    });
    
    // Render component
    renderWithProviders(&lt;Backups /&gt;);
    
    // Wait for data to load
    await waitFor(() => {
      expect(screen.getByText('Database Backup')).toBeInTheDocument();
    });
    
    // Verify UI elements
    expect(screen.getByText('Active')).toBeInTheDocument();
    expect(screen.getByText('Daily at 03:00')).toBeInTheDocument();
  });
});</code></pre>
        </div>
    </div>

    <div class="container">
        <h2 id="ci-cd">Continuous Integration</h2>
        
        <p>We have implemented a CI/CD pipeline using GitHub Actions to automate testing and deployment.</p>
        
        <h3>Automated Testing</h3>
        <p>Our GitHub Actions workflow runs all tests automatically on:</p>
        <ul>
            <li>Every push to main and develop branches</li>
            <li>Every pull request to main and develop branches</li>
        </ul>
        
        <h3>Test Pipeline</h3>
        <div class="code-block">
            <pre><code># test.yml workflow
name: Altaro Cloud Backup Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  backend-tests:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2
      
    - name: Run unit tests
      run: cd backend && npm run test:unit
      
    - name: Run integration tests
      run: cd backend && npm run test:integration
    
    - name: Run E2E tests
      run: cd backend && npm run test:e2e</code></pre>
        </div>
        
        <h3>Coverage Reports</h3>
        <p>Coverage reports are generated and uploaded to Codecov after tests run.</p>
        <div class="metrics">
            <div class="metric">
                <h4>Backend Coverage</h4>                <div class="progress">
                    <div class="progress-bar progress-bar-78">78%</div>
                </div>
            </div>
            <div class="metric">
                <h4>Frontend Coverage</h4>
                <div class="progress">
                    <div class="progress-bar progress-bar-65">65%</div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>Getting Started with Testing</h2>
        
        <p>Follow these steps to start working with our test suite:</p>
        
        <ol>
            <li>Install dependencies:
                <pre><code>npm install</code></pre>
            </li>
            <li>Run all tests:
                <pre><code>npm test</code></pre>
            </li>
            <li>Run tests with watch mode (for development):
                <pre><code>npm run test:watch</code></pre>
            </li>
            <li>Generate a coverage report:
                <pre><code>npm run test:coverage</code></pre>
            </li>
        </ol>
        
        <p>For creating new tests, follow these steps:</p>
        
        <ol>
            <li>Identify the component or functionality to test</li>
            <li>Create a new test file in the appropriate directory</li>
            <li>Write test cases using the Arrange-Act-Assert pattern</li>
            <li>Run the tests to verify your implementation</li>
        </ol>
          <div class="center-buttons">
            <a href="https://jestjs.io/docs/getting-started" class="btn" target="_blank" rel="noopener noreferrer">Jest Documentation</a>
            <a href="https://github.com/visionmedia/supertest" class="btn" target="_blank" rel="noopener noreferrer">Supertest Documentation</a>
            <a href="https://mongoosejs.com/docs/jest.html" class="btn" target="_blank" rel="noopener noreferrer">Mongoose Testing Guide</a>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Altaro Cloud Backup. All rights reserved.</p>
        <p>Testing Documentation v1.0.0</p>
    </footer>
</body>
</html>
